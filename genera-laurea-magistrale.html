<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Genera Laurea Magistrale - Accademia Online Globale</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Aggiornamento del link FontAwesome per evitare problemi di compatibilità -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
    <style>
        .form-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 3px 15px rgba(0,0,0,0.1);
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
        }
        
        .form-row .form-group {
            flex: 1;
        }
        
        .preview-container {
            margin-top: 40px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #f9f9f9;
        }
        
        .degree-preview {
            background: #fff;
            padding: 40px;
            border: 10px solid #0056b3;
            text-align: center;
            position: relative;
            max-width: 700px;
            margin: 0 auto;
        }
        
        .degree-preview h2 {
            font-size: 28px;
            margin-bottom: 20px;
            color: #0056b3;
        }
        
        .degree-preview .seal {
            position: absolute;
            bottom: 30px;
            right: 30px;
            width: 100px;
            height: 100px;
            background: #0056b3;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .barcode {
            margin-top: 20px;
            padding: 10px;
            background: #f0f0f0;
            display: inline-block;
        }
        
        /* Add error state styling for form validation */
        .form-group input.error, .form-group select.error {
            border-color: #ff3860;
            background-color: #fff8f8;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="logo">
                <h1>Accademia Online Globale</h1>
            </div>
            <nav>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="programs.html">Programmi</a></li>
                    <li><a href="accreditation.html">Accreditamento</a></li>
                    <li><a href="verification.html">Verifica Certificato</a></li>
                    <li><a href="about.html">Chi Siamo</a></li>
                    <li><a href="contact.html">Contatti</a></li>
                    <li><a href="genera-certificati.html">Genera Certificati</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="page-header">
        <div class="container">
            <h2>Genera Laurea Magistrale</h2>
            <p>Compila il modulo per generare la tua laurea magistrale personalizzata</p>
        </div>
    </section>

    <section class="degree-generator">
        <div class="container">
            <div id="exam-verification-container">
                <!-- This will be populated by JavaScript based on exam status -->
            </div>
            
            <div class="form-container" id="degree-form-container" style="display: none;">
                <form id="degree-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="nome">Nome</label>
                            <input type="text" id="nome" name="nome" required>
                        </div>
                        <div class="form-group">
                            <label for="cognome">Cognome</label>
                            <input type="text" id="cognome" name="cognome" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="corso">Corso di Laurea Magistrale</label>
                        <select id="corso" name="corso" required>
                            <option value="">Seleziona un corso</option>
                            <option value="MBA">MBA</option>
                            <option value="Istruzione">Istruzione</option>
                            <option value="Salute Pubblica">Salute Pubblica</option>
                            <option value="Data Science">Data Science</option>
                        </select>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="data-nascita">Data di Nascita</label>
                            <input type="date" id="data-nascita" name="data-nascita" required>
                        </div>
                        <div class="form-group">
                            <label for="luogo-nascita">Luogo di Nascita</label>
                            <input type="text" id="luogo-nascita" name="luogo-nascita" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="data-laurea">Data di Conseguimento</label>
                            <input type="date" id="data-laurea" name="data-laurea" required>
                        </div>
                        <div class="form-group">
                            <label for="voto">Voto Finale</label>
                            <input type="text" id="voto" name="voto" placeholder="es. 110/110 e lode" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="tesi">Titolo Tesi</label>
                        <input type="text" id="tesi" name="tesi" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="relatore">Relatore</label>
                        <input type="text" id="relatore" name="relatore" required>
                    </div>
                    
                    <div class="form-group">
                        <button type="submit" class="btn">Genera Laurea</button>
                    </div>
                </form>
                
                <div class="preview-container" style="display: none;" id="preview-section">
                    <h3>Anteprima della Laurea Magistrale</h3>
                    <div class="degree-preview" id="degree-preview">
                        <h2>Accademia Online Globale</h2>
                        <h3>Laurea Magistrale in</h3>
                        <h3 id="preview-corso"></h3>
                        <p>Si certifica che</p>
                        <h3 id="preview-nome"></h3>
                        <p>nato/a il <span id="preview-data-nascita"></span> a <span id="preview-luogo-nascita"></span></p>
                        <p>ha completato con successo il corso di laurea magistrale in</p>
                        <h3 id="preview-corso-2"></h3>
                        <p>con il voto di <span id="preview-voto"></span></p>
                        <p>discutendo la tesi dal titolo:</p>
                        <p><em id="preview-tesi"></em></p>
                        <p>Relatore: Prof. <span id="preview-relatore"></span></p>
                        <p>in data <span id="preview-data-laurea"></span></p>
                        
                        <div class="signatures">
                            <p>Il Rettore</p>
                            <p>_____________________</p>
                        </div>
                        
                        <div class="seal">AOG</div>
                        
                        <div class="barcode">
                            <p>Codice di Verifica: <span id="preview-codice"></span></p>
                        </div>
                    </div>
                    
                    <div class="download-options" style="margin-top: 20px; text-align: center;">
                        <button class="btn" id="download-btn">Scarica Laurea</button>
                        <button class="btn-small" id="print-btn">Stampa</button>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-cols">
                <div class="footer-col">
                    <h4>Accademia Online Globale</h4>
                    <p>Forniamo istruzione di qualità in tutto il mondo dal 2023</p>
                </div>
                <div class="footer-col">
                    <h4>Link Rapidi</h4>
                    <ul>
                        <li><a href="programs.html">Programmi</a></li>
                        <li><a href="admission.html">Ammissione</a></li>
                        <li><a href="faq.html">FAQ</a></li>
                        <li><a href="genera-certificati.html">Genera Certificati</a></li>
                    </ul>
                </div>
                <div class="footer-col">
                    <h4>Contattaci</h4>
                    <p>Email: info@accademiaonlineglobale.edu</p>
                    <p>Telefono: +39 06 1234567</p>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2023 Accademia Online Globale. Tutti i diritti riservati.</p>
            </div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user has passed the exam
            const examStatus = localStorage.getItem('examStatus');
            const examPath = localStorage.getItem('examPath');
            const examDate = localStorage.getItem('examDate');
            const verificationContainer = document.getElementById('exam-verification-container');
            const formContainer = document.getElementById('degree-form-container');
            
            // Format date function
            function formatDate(dateString) {
                if (!dateString) return 'Data non disponibile';
                try {
                    const date = new Date(dateString);
                    return date.toLocaleDateString('it-IT', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                } catch (e) {
                    return 'Data non valida';
                }
            }
            
            // Check exam status and show appropriate message
            if (examStatus === 'passed' && examPath === 'magistrale') {
                // User has passed the magistrale exam
                verificationContainer.innerHTML = `
                    <div style="background-color: #d4edda; border-left: 4px solid #28a745; padding: 15px; border-radius: 8px; margin-bottom: 30px;">
                        <h3 style="color: #155724; margin-top: 0;"><i class="fas fa-check-circle"></i> Esame Superato</h3>
                        <p>Hai superato l'esame di valutazione in data ${formatDate(examDate)}.</p>
                        <p>Ora puoi procedere con la generazione della tua laurea magistrale.</p>
                    </div>
                `;
                formContainer.style.display = 'block';
            } else if (examStatus === 'passed' && examPath !== 'magistrale') {
                // User has passed a different exam
                verificationContainer.innerHTML = `
                    <div style="background-color: #fff3cd; border-left: 4px solid #ffc107; padding: 15px; border-radius: 8px; margin-bottom: 30px;">
                        <h3 style="color: #856404; margin-top: 0;"><i class="fas fa-exclamation-triangle"></i> Esame Non Corrispondente</h3>
                        <p>Hai superato un esame diverso (${examPath}) in data ${formatDate(examDate)}.</p>
                        <p>Per generare una laurea magistrale, devi superare l'esame specifico per questo tipo di certificato.</p>
                        <a href="esame.html?type=magistrale" class="btn" style="margin-top: 10px;">Vai all'Esame</a>
                    </div>
                `;
            } else if (examStatus === 'failed') {
                // User has failed the exam
                verificationContainer.innerHTML = `
                    <div style="background-color: #f8d7da; border-left: 4px solid #dc3545; padding: 15px; border-radius: 8px; margin-bottom: 30px;">
                        <h3 style="color: #721c24; margin-top: 0;"><i class="fas fa-times-circle"></i> Esame Non Superato</h3>
                        <p>Non hai superato l'esame di valutazione in data ${formatDate(examDate)}.</p>
                        <p>Per generare una laurea magistrale, devi prima superare l'esame di valutazione.</p>
                        <a href="esame.html?type=magistrale" class="btn" style="margin-top: 10px;">Riprova l'Esame</a>
                    </div>
                `;
            } else {
                // User has not taken the exam
                verificationContainer.innerHTML = `
                    <div style="background-color: #f8f9fa; border-left: 4px solid #6c757d; padding: 15px; border-radius: 8px; margin-bottom: 30px;">
                        <h3 style="color: #6c757d; margin-top: 0;"><i class="fas fa-info-circle"></i> Esame Non Sostenuto</h3>
                        <p>Non hai ancora sostenuto l'esame di valutazione.</p>
                        <p>Per generare una laurea magistrale, devi prima superare l'esame di valutazione.</p>
                        <a href="esame.html?type=magistrale" class="btn" style="margin-top: 10px;">Vai all'Esame</a>
                    </div>
                `;
            }
            
            const degreeForm = document.getElementById('degree-form');
            const previewSection = document.getElementById('preview-section');
            const downloadBtn = document.getElementById('download-btn');
            const printBtn = document.getElementById('print-btn');
            
            degreeForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Get form values
                const nome = document.getElementById('nome').value;
                const cognome = document.getElementById('cognome').value;
                const corso = document.getElementById('corso').value;
                const dataNascita = new Date(document.getElementById('data-nascita').value);
                const luogoNascita = document.getElementById('luogo-nascita').value;
                const dataLaurea = new Date(document.getElementById('data-laurea').value);
                const voto = document.getElementById('voto').value;
                const tesi = document.getElementById('tesi').value;
                const relatore = document.getElementById('relatore').value;
                
                // Format dates with better error handling
                let formattedDataNascita, formattedDataLaurea;
                
                try {
                    formattedDataNascita = dataNascita.toLocaleDateString('it-IT');
                    if (formattedDataNascita === 'Invalid Date') throw new Error('Invalid date');
                } catch (error) {
                    formattedDataNascita = 'Data non valida';
                }
                
                try {
                    formattedDataLaurea = dataLaurea.toLocaleDateString('it-IT');
                    if (formattedDataLaurea === 'Invalid Date') throw new Error('Invalid date');
                } catch (error) {
                    formattedDataLaurea = 'Data non valida';
                }
                
                // Generate verification code
                const verificationCode = generateVerificationCode(nome, cognome, dataNascita);
                
                // Update preview
                document.getElementById('preview-nome').textContent = nome + ' ' + cognome;
                document.getElementById('preview-data-nascita').textContent = formattedDataNascita;
                document.getElementById('preview-luogo-nascita').textContent = luogoNascita;
                document.getElementById('preview-corso').textContent = corso;
                document.getElementById('preview-corso-2').textContent = corso;
                document.getElementById('preview-voto').textContent = voto;
                document.getElementById('preview-tesi').textContent = tesi;
                document.getElementById('preview-relatore').textContent = relatore;
                document.getElementById('preview-data-laurea').textContent = formattedDataLaurea;
                document.getElementById('preview-codice').textContent = verificationCode;
                
                // Show preview section
                previewSection.style.display = 'block';
                
                // Scroll to preview
                previewSection.scrollIntoView({ behavior: 'smooth' });
            });
            
            // Function to generate a verification code
            function generateVerificationCode(nome, cognome, dataNascita) {
                const timestamp = new Date().getTime();
                const randomNum = Math.floor(Math.random() * 10000);
                const nameInitials = nome.charAt(0) + cognome.charAt(0);
                // Verifica che dataNascita sia una data valida
                const birthYear = isNaN(dataNascita.getFullYear()) ? new Date().getFullYear() : dataNascita.getFullYear();
                
                return `AOG-LM-${nameInitials}${birthYear}-${randomNum}-${timestamp.toString().slice(-6)}`;
            }
            
            // Aggiunta di controlli di validazione per i campi del form
            degreeForm.querySelectorAll('input[required], select[required]').forEach(field => {
                field.addEventListener('invalid', function() {
                    this.classList.add('error');
                });
                
                field.addEventListener('input', function() {
                    this.classList.remove('error');
                });
            });
            
            // Download functionality (simplified - in a real app would use html2canvas or similar)
            downloadBtn.addEventListener('click', function() {
                try {
                    // In a real application, we would implement PDF generation here
                    alert('In un\'applicazione reale, questa funzione scaricherebbe la laurea come PDF.');
                } catch (error) {
                    alert('Si è verificato un errore durante la generazione del PDF: ' + error.message);
                }
            });
            
            // Print functionality
            printBtn.addEventListener('click', function() {
                window.print();
            });
        });
    </script>
</body>
</html>